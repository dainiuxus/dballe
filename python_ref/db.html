
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>database functions &#8212; dballe 3.23 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="database explorer" href="explorer.html" />
    <link rel="prev" title="dballe cursors" href="cursors.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="database-functions">
<h1>database functions<a class="headerlink" href="#database-functions" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<dl class="class">
<dt id="dballe.DB">
<em class="property">class </em><code class="sig-prename descclassname">dballe.</code><code class="sig-name descname">DB</code><a class="headerlink" href="#dballe.DB" title="Permalink to this definition">¶</a></dt>
<dd><p>DB-All.e database access.</p>
<p>Many methods are the same in <a class="reference internal" href="#dballe.DB" title="dballe.DB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.DB</span></code></a> and
<a class="reference internal" href="#dballe.Transaction" title="dballe.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Transaction</span></code></a>. The versions in <a class="reference internal" href="#dballe.DB" title="dballe.DB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.DB</span></code></a> are implemented
by automatically creating a temporary transaction and running the equivalent
<a class="reference internal" href="#dballe.Transaction" title="dballe.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Transaction</span></code></a> method inside it.</p>
<p><a class="reference internal" href="#dballe.DB" title="dballe.DB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.DB</span></code></a> objects are not constructed explicitly, but via one of the
<a class="reference internal" href="#dballe.DB.connect" title="dballe.DB.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">DB.connect()</span></code></a> or <a class="reference internal" href="#dballe.DB.connect_test" title="dballe.DB.connect_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">DB.connect_test()</span></code></a> class methods.</p>
<p>See <a class="reference internal" href="../python_how/dumpdb.html#python-how-dumpdb"><span class="std std-ref">Dump the contents of the database</span></a> and <a class="reference internal" href="../python_how/insert.html#python-how-insert"><span class="std std-ref">Insert data into a db</span></a> examples.</p>
<dl class="method">
<dt id="dballe.DB.attr_insert_data">
<code class="sig-name descname">attr_insert_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.attr_insert_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert new data attributes into the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.attr_insert_station">
<code class="sig-name descname">attr_insert_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.attr_insert_station" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert new constant station data attributes into the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.attr_query_data">
<code class="sig-name descname">attr_query_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int</em><span class="sig-paren">)</span> &#x2192; Dict[str, Any]<a class="headerlink" href="#dballe.DB.attr_query_data" title="Permalink to this definition">¶</a></dt>
<dd><p>query data attributes</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.attr_query_station">
<code class="sig-name descname">attr_query_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int</em><span class="sig-paren">)</span> &#x2192; Dict[str, Any]<a class="headerlink" href="#dballe.DB.attr_query_station" title="Permalink to this definition">¶</a></dt>
<dd><p>query constant station data attributes</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.attr_remove_data">
<code class="sig-name descname">attr_remove_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Iterable[str]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.attr_remove_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove attributes from data</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.attr_remove_station">
<code class="sig-name descname">attr_remove_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Iterable[str]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.attr_remove_station" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove attributes from constant station data</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.connect">
<code class="sig-name descname">connect</code><span class="sig-paren">(</span><em class="sig-param">url: str</em><span class="sig-paren">)</span> &#x2192; dballe.DB<a class="headerlink" href="#dballe.DB.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>create a DB to access a database identified by a DB-All.e URL</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.connect_from_file">
<code class="sig-name descname">connect_from_file</code><span class="sig-paren">(</span><em class="sig-param">name: str</em><span class="sig-paren">)</span> &#x2192; dballe.DB<a class="headerlink" href="#dballe.DB.connect_from_file" title="Permalink to this definition">¶</a></dt>
<dd><p>create a DB to access a SQLite file</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.connect_from_url">
<code class="sig-name descname">connect_from_url</code><span class="sig-paren">(</span><em class="sig-param">url: str</em><span class="sig-paren">)</span> &#x2192; dballe.DB<a class="headerlink" href="#dballe.DB.connect_from_url" title="Permalink to this definition">¶</a></dt>
<dd><p>create a DB to access a database identified by a DB-All.e URL (deprecated, use connect instead)</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.connect_test">
<code class="sig-name descname">connect_test</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; dballe.DB<a class="headerlink" href="#dballe.DB.connect_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a DB for running the test suite, as configured in the test environment</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.disappear">
<code class="sig-name descname">disappear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.disappear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all DB-All.e tables and data from the database, if possible</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.get_default_format">
<code class="sig-name descname">get_default_format</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#dballe.DB.get_default_format" title="Permalink to this definition">¶</a></dt>
<dd><p>get the default DB format</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.import_messages">
<code class="sig-name descname">import_messages</code><span class="sig-paren">(</span><em class="sig-param">messages: Union[dballe.Message, Sequence[dballe.Message], Iterable[dballe.Message], dballe.ImporterFile], report: str=None, import_attributes: bool=False, update_station: bool=False, overwrite: bool=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.import_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Import one or more Messages into the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>messages</strong> – <ul>
<li><p>a <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> object</p></li>
<li><p>a sequence or iterable of <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> objects</p></li>
<li><p>a <a class="reference internal" href="messages.html#dballe.ImporterFile" title="dballe.ImporterFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.ImporterFile</span></code></a> that generates a sequence of <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> objects</p></li>
</ul>
</p></li>
<li><p><strong>report</strong> – the network name to use for importing the data. If left to None,
the network is selected automatically from the message type</p></li>
<li><p><strong>import_attributes</strong> – if set to True, requests the variable attributes to
also be imported.</p></li>
<li><p><strong>update_station</strong> – if set to True, station information is merged with existing
one in the database. If false (default), station
information is imported only when the station did not
exist in the database.</p></li>
<li><p><strong>overwrite</strong> – if set to True, causes existing information already in the
database to be overwritten. If false (default), trying to
import a message which contains data already present in the
database causes the import to fail.</p></li>
<li><p><strong>varlist</strong> – if set to a string in the same format as the <cite>varlist</cite> query
parameter, only imports data whose varcode is in the list.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.insert_data">
<code class="sig-name descname">insert_data</code><span class="sig-paren">(</span><em class="sig-param">record: Union[Dict[str, Any], dballe.Cursor, dballe.Data], can_replace: bool=False, can_add_stations: bool=False</em><span class="sig-paren">)</span> &#x2192; Dict[str, int]<a class="headerlink" href="#dballe.DB.insert_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert data values in the database</p>
<p>The return value is a dict that always contains <cite>ana_id</cite> mapped to the station
ID just inserted, and an entry for each varcode inserted mapping to the
database ID of its value.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.insert_station_data">
<code class="sig-name descname">insert_station_data</code><span class="sig-paren">(</span><em class="sig-param">record: Union[Dict[str, Any], dballe.Cursor, dballe.Data], can_replace: bool=False, can_add_stations: bool=False</em><span class="sig-paren">)</span> &#x2192; Dict[str, int]<a class="headerlink" href="#dballe.DB.insert_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert station values in the database</p>
<p>The return value is a dict that always contains <cite>ana_id</cite> mapped to the station
ID just inserted, and an entry for each varcode inserted mapping to the
database ID of its value.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.is_url">
<code class="sig-name descname">is_url</code><span class="sig-paren">(</span><em class="sig-param">url: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#dballe.DB.is_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if a string looks like a DB-All.e DB url</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.query_data">
<code class="sig-name descname">query_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorData<a class="headerlink" href="#dballe.DB.query_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the data in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorDataDB" title="dballe.CursorDataDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorDataDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.query_messages">
<code class="sig-name descname">query_messages</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorMessage<a class="headerlink" href="#dballe.DB.query_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the database returning the matching data as Message objects</p>
<p>This can also be used to export messages to a file. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span> <span class="o">=</span> <span class="n">dballe</span><span class="o">.</span><span class="n">Exporter</span><span class="p">(</span><span class="s2">&quot;BUFR&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.bufr&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">query_messages</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exporter</span><span class="o">.</span><span class="n">to_binary</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
</pre></div>
</div>
<p>See: <a class="reference internal" href="messages.html#dballe.Exporter" title="dballe.Exporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Exporter</span></code></a> and <a class="reference internal" href="cursors.html#dballe.CursorMessage" title="dballe.CursorMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorMessage</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.query_station_data">
<code class="sig-name descname">query_station_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorStationData<a class="headerlink" href="#dballe.DB.query_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the constant station data in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorStationDataDB" title="dballe.CursorStationDataDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorStationDataDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.query_stations">
<code class="sig-name descname">query_stations</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorStation<a class="headerlink" href="#dballe.DB.query_stations" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the stations in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorStationDB" title="dballe.CursorStationDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorStationDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.query_summary">
<code class="sig-name descname">query_summary</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorSummary<a class="headerlink" href="#dballe.DB.query_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the summary of the results of a query</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorSummaryDB" title="dballe.CursorSummaryDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorSummaryDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.remove">
<code class="sig-name descname">remove</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove data variables from the database (deprecated)</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.remove_all">
<code class="sig-name descname">remove_all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.remove_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all data from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.remove_data">
<code class="sig-name descname">remove_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.remove_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove data variables from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.remove_station_data">
<code class="sig-name descname">remove_station_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.remove_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove station variables from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param">repinfo_file: str=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the database, removing all existing Db-All.e tables and re-creating them empty.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.set_default_format">
<code class="sig-name descname">set_default_format</code><span class="sig-paren">(</span><em class="sig-param">format: str</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.set_default_format" title="Permalink to this definition">¶</a></dt>
<dd><p>set the default DB format</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.transaction">
<code class="sig-name descname">transaction</code><span class="sig-paren">(</span><em class="sig-param">readonly: bool=False</em><span class="sig-paren">)</span> &#x2192; dballe.Transaction<a class="headerlink" href="#dballe.DB.transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new database transaction</p>
</dd></dl>

<dl class="method">
<dt id="dballe.DB.vacuum">
<code class="sig-name descname">vacuum</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.DB.vacuum" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform database cleanup operations</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dballe.Transaction">
<em class="property">class </em><code class="sig-prename descclassname">dballe.</code><code class="sig-name descname">Transaction</code><a class="headerlink" href="#dballe.Transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>DB-All.e transaction</p>
<p>A Transaction is used to execute DB operations in an all-or-nothing fashion. In
fact, most DB methods are implemented using a short-lived temporary
transaction.</p>
<p>You cannot have more than one active dballe.Transaction for each dballe.DB. An
attempt to start a second one will result in an exception being raised. Note
that dballe.DB functions like <a class="reference internal" href="#dballe.Transaction.insert_data" title="dballe.Transaction.insert_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">dballe.Transaction.insert_data()</span></code></a> create a
temporary transaction to run, and so they will also fail if a transaction is
currently open. The general idea is that all database work should be done
inside a transaction.</p>
<p>Transactions run using the <cite>REPEATABLE READ</cite> isolation level of the underlying
database. This usually means that modifications performed inside a transaction
are not visible to other database connections until the transaction is
committed. If a transaction is rolled back, all changes done with it are
undone.</p>
<p>Transactions can also be used as context managers, which calls
<a class="reference internal" href="#dballe.Transaction.commit" title="dballe.Transaction.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dballe.Transaction.commit()</span></code></a> automatically, or
<a class="reference internal" href="#dballe.Transaction.rollback" title="dballe.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dballe.Transaction.rollback()</span></code></a> if the code raised an exception:</p>
<p>The dballe.Transaction methods are the same as those in dballe.DB. The version
in dballe.DB is implemented by automatically creating a temporary transaction
and running the dballe.Transaction method inside it.</p>
<p>See <a class="reference internal" href="../python_how/dumpdb.html#python-how-dumpdb"><span class="std std-ref">Dump the contents of the database</span></a> and <a class="reference internal" href="../python_how/insert.html#python-how-insert"><span class="std std-ref">Insert data into a db</span></a> examples.</p>
<dl class="method">
<dt id="dballe.Transaction.attr_insert_data">
<code class="sig-name descname">attr_insert_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.attr_insert_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert new data attributes into the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.attr_insert_station">
<code class="sig-name descname">attr_insert_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.attr_insert_station" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert new constant station data attributes into the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.attr_query_data">
<code class="sig-name descname">attr_query_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int</em><span class="sig-paren">)</span> &#x2192; Dict[str, Any]<a class="headerlink" href="#dballe.Transaction.attr_query_data" title="Permalink to this definition">¶</a></dt>
<dd><p>query data attributes</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.attr_query_station">
<code class="sig-name descname">attr_query_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int</em><span class="sig-paren">)</span> &#x2192; Dict[str, Any]<a class="headerlink" href="#dballe.Transaction.attr_query_station" title="Permalink to this definition">¶</a></dt>
<dd><p>query constant station data attributes</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.attr_remove_data">
<code class="sig-name descname">attr_remove_data</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Iterable[str]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.attr_remove_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove attributes from data</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.attr_remove_station">
<code class="sig-name descname">attr_remove_station</code><span class="sig-paren">(</span><em class="sig-param">varid: int, attrs: Iterable[str]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.attr_remove_station" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove attributes from constant station data</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.commit">
<code class="sig-name descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>commit the transaction</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.import_messages">
<code class="sig-name descname">import_messages</code><span class="sig-paren">(</span><em class="sig-param">messages: Union[dballe.Message, Sequence[dballe.Message], Iterable[dballe.Message], dballe.ImporterFile], report: str=None, import_attributes: bool=False, update_station: bool=False, overwrite: bool=False</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.import_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Import one or more Messages into the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>messages</strong> – <ul>
<li><p>a <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> object</p></li>
<li><p>a sequence or iterable of <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> objects</p></li>
<li><p>a <a class="reference internal" href="messages.html#dballe.ImporterFile" title="dballe.ImporterFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.ImporterFile</span></code></a> that generates a sequence of <a class="reference internal" href="messages.html#dballe.Message" title="dballe.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Message</span></code></a> objects</p></li>
</ul>
</p></li>
<li><p><strong>report</strong> – the network name to use for importing the data. If left to None,
the network is selected automatically from the message type</p></li>
<li><p><strong>import_attributes</strong> – if set to True, requests the variable attributes to
also be imported.</p></li>
<li><p><strong>update_station</strong> – if set to True, station information is merged with existing
one in the database. If false (default), station
information is imported only when the station did not
exist in the database.</p></li>
<li><p><strong>overwrite</strong> – if set to True, causes existing information already in the
database to be overwritten. If false (default), trying to
import a message which contains data already present in the
database causes the import to fail.</p></li>
<li><p><strong>varlist</strong> – if set to a string in the same format as the <cite>varlist</cite> query
parameter, only imports data whose varcode is in the list.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.insert_data">
<code class="sig-name descname">insert_data</code><span class="sig-paren">(</span><em class="sig-param">record: Union[Dict[str, Any], dballe.Cursor, dballe.Data], can_replace: bool=False, can_add_stations: bool=False</em><span class="sig-paren">)</span> &#x2192; Dict[str, int]<a class="headerlink" href="#dballe.Transaction.insert_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert data values in the database</p>
<p>The return value is a dict that always contains <cite>ana_id</cite> mapped to the station
ID just inserted, and an entry for each varcode inserted mapping to the
database ID of its value.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.insert_station_data">
<code class="sig-name descname">insert_station_data</code><span class="sig-paren">(</span><em class="sig-param">record: Union[Dict[str, Any], dballe.Cursor, dballe.Data], can_replace: bool=False, can_add_stations: bool=False</em><span class="sig-paren">)</span> &#x2192; Dict[str, int]<a class="headerlink" href="#dballe.Transaction.insert_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert station values in the database</p>
<p>The return value is a dict that always contains <cite>ana_id</cite> mapped to the station
ID just inserted, and an entry for each varcode inserted mapping to the
database ID of its value.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.query_data">
<code class="sig-name descname">query_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorData<a class="headerlink" href="#dballe.Transaction.query_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the data in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorDataDB" title="dballe.CursorDataDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorDataDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.query_messages">
<code class="sig-name descname">query_messages</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorMessage<a class="headerlink" href="#dballe.Transaction.query_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the database returning the matching data as Message objects</p>
<p>This can also be used to export messages to a file. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span> <span class="o">=</span> <span class="n">dballe</span><span class="o">.</span><span class="n">Exporter</span><span class="p">(</span><span class="s2">&quot;BUFR&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.bufr&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">query_messages</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exporter</span><span class="o">.</span><span class="n">to_binary</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
</pre></div>
</div>
<p>See: <a class="reference internal" href="messages.html#dballe.Exporter" title="dballe.Exporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.Exporter</span></code></a> and <a class="reference internal" href="cursors.html#dballe.CursorMessage" title="dballe.CursorMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorMessage</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.query_station_data">
<code class="sig-name descname">query_station_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorStationData<a class="headerlink" href="#dballe.Transaction.query_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the constant station data in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorStationDataDB" title="dballe.CursorStationDataDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorStationDataDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.query_stations">
<code class="sig-name descname">query_stations</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorStation<a class="headerlink" href="#dballe.Transaction.query_stations" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the stations in the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorStationDB" title="dballe.CursorStationDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorStationDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.query_summary">
<code class="sig-name descname">query_summary</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span> &#x2192; dballe.CursorSummary<a class="headerlink" href="#dballe.Transaction.query_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Query the summary of the results of a query</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a cursor to iterate the query results (see <a class="reference internal" href="cursors.html#dballe.CursorSummaryDB" title="dballe.CursorSummaryDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">dballe.CursorSummaryDB</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.remove">
<code class="sig-name descname">remove</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove data variables from the database (deprecated)</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.remove_all">
<code class="sig-name descname">remove_all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.remove_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all data from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.remove_data">
<code class="sig-name descname">remove_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.remove_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove data variables from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.remove_station_data">
<code class="sig-name descname">remove_station_data</code><span class="sig-paren">(</span><em class="sig-param">query: Dict[str, Any]</em><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.remove_station_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove station variables from the database</p>
</dd></dl>

<dl class="method">
<dt id="dballe.Transaction.rollback">
<code class="sig-name descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dballe.Transaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>roll back the transaction</p>
</dd></dl>

</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">dballe</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">How-to guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference.html">Reference documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../general_ref/index.html">General reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Python reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp_ref/index.html">C++ reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fortran_ref/index.html">Fortran reference</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../reference.html">Reference documentation</a><ul>
  <li><a href="index.html">Python reference</a><ul>
      <li>Previous: <a href="cursors.html" title="previous chapter">dballe cursors</a></li>
      <li>Next: <a href="explorer.html" title="next chapter">database explorer</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Enrico Zini.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/python_ref/db.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>