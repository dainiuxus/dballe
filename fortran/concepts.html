
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Fortran API concepts &#8212; dballe 3.23 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A walk through the Fortran API" href="walkthrough.html" />
    <link rel="prev" title="Fortran dballe functions" href="dballe.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fortran-api-concepts">
<h1>Fortran API concepts<a class="headerlink" href="#fortran-api-concepts" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="connections-sessions-and-handles">
<span id="sessions"></span><h2>Connections, sessions and handles<a class="headerlink" href="#connections-sessions-and-handles" title="Permalink to this headline">¶</a></h2>
<p>DB-All.e stores meteorological values in a database.  This database can be
optionally shared or accessed using the network.</p>
<p>You contact DB-All.e by creating a <em>connection</em>, and you work in DB-All.e using
one or more <em>sessions</em>.  A connection is an established link between your
program and DB-All.e, and you usually open it at the beginning of your work and
close it at the end.</p>
<p>Within a connection you can create many working sessions.  This is used to do
different things at the same time, like reading a set of values while writing
computed results.</p>
<p>You can also set some safety features on sessions: for example, when you create
a session for reading values you can set it to disable all writes, which helps
you catch some programming mistakes.</p>
<p>You refer to the connection and the sessions using <em>handles</em>.  A handle is an
integer value that you use when you need to refer to something that is not
otherwise representable in any Fortran data type.</p>
<p>When you create a connection or a session, DB-All.e will give you the integer
handle that you will later use to refer to it.</p>
<p>Sessions run with their own database transaction, which means that the changes
they perform on data are handled in an all-or-nothing fashion. If you close a
session with <a class="reference internal" href="reference.html#c.idba_commit" title="idba_commit"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_commit()</span></code></a>, then all the changes made will be preserved. If
you do not call <a class="reference internal" href="reference.html#c.idba_commit" title="idba_commit"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_commit()</span></code></a>, such as if your program unexpectedly
terminates, then all the changes made will be undone.</p>
</div>
<div class="section" id="report">
<span id="id1"></span><h2>Report<a class="headerlink" href="#report" title="Permalink to this headline">¶</a></h2>
<p>A homogeneous group of stations with the same kind of measures and management
(for example: <code class="docutils literal notranslate"><span class="pre">synop</span></code>, <code class="docutils literal notranslate"><span class="pre">metar</span></code>, a specific kind of forecast…).</p>
<p>The type of report implicitly defines a priority of the measured value over
other equivalent values.  This can be used to select a “best value” from a
specific set of coordinates, where for example, values measured by synoptic
stations are preferred over values measured by a satellite, which in turn is
preferred over a value computed by a forecast model (see <a class="reference internal" href="../parms/query.html#parms-query-modifiers"><span class="std std-ref">Possible values for query modifiers</span></a>).</p>
<p>Priorities associated to the report type can be customized when creating the
database (see <a class="reference internal" href="reference.html#c.idba_reinit_db" title="idba_reinit_db"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_reinit_db()</span></code></a>).</p>
</div>
<div class="section" id="station">
<span id="id2"></span><h2>Station<a class="headerlink" href="#station" title="Permalink to this headline">¶</a></h2>
<p>Stations are uniquely identified by:</p>
<ul class="simple">
<li><em>latitude</em>.</li>
<li><em>longitude</em>.</li>
<li><em>station identifier</em> (if the station is mobile).</li>
<li><em>rep_memo</em></li>
</ul>
</div>
<div class="section" id="station-values">
<h2>Station values<a class="headerlink" href="#station-values" title="Permalink to this headline">¶</a></h2>
<p>Each station entry can have zero or more values associated to it. They are just
like measured variables, but lack date, time, level, and time range
information. They can be used to store station attributes, like the height
above sea level, or the center operating it.</p>
<p>The interface to work with station values is the same as the interface to work
with normal values, except that date, time, level, and timerange information
are not set when inserting or querying data, and
<a class="reference internal" href="reference.html#c.idba_set_station_context" title="idba_set_station_context"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_set_station_context()</span></code></a> is called instead, to signal the
intention of working with station values.</p>
<p>See <a class="reference internal" href="walkthrough.html#querying"><span class="std std-ref">Querying the database</span></a> for examples on how to work with values.</p>
</div>
<div class="section" id="level-or-layer">
<h2>Level or layer<a class="headerlink" href="#level-or-layer" title="Permalink to this headline">¶</a></h2>
<p>The vertical coordinate of a value in DB-All.e is described using a level
description or a layer description.</p>
<p>A level is defined univocally by a code table (<code class="docutils literal notranslate"><span class="pre">leveltype1</span></code>) and a
numerical value (<code class="docutils literal notranslate"><span class="pre">l1</span></code>).</p>
<p>A layer is defined univocally by its two bounding levels (<code class="docutils literal notranslate"><span class="pre">leveltype1</span></code>,
<code class="docutils literal notranslate"><span class="pre">l1</span></code>, <code class="docutils literal notranslate"><span class="pre">leveltype2</span></code>, <code class="docutils literal notranslate"><span class="pre">l2</span></code>).</p>
<p>See <a class="reference internal" href="../ltypes.html#levels"><span class="std std-ref">Level type values</span></a> for a description of the level types and
associated level values.</p>
</div>
<div class="section" id="time-range">
<h2>Time range<a class="headerlink" href="#time-range" title="Permalink to this headline">¶</a></h2>
<p>Another characteristic of a value in DB-All.e is the time period to which the
datum refers: it can be, for example, a value measured in a specific instant,
or a cumulated or averaged value over an interval of time.</p>
<p>The time range is defined by a table code (<code class="docutils literal notranslate"><span class="pre">pindicator</span></code>) and two
numerical values (<code class="docutils literal notranslate"><span class="pre">p1</span></code> and <code class="docutils literal notranslate"><span class="pre">p2</span></code>). For their meaning, see <a class="reference internal" href="../tranges.html#tranges"><span class="std std-ref">Time range values</span></a>.</p>
</div>
<div class="section" id="variable-code-varcode">
<span id="varcode"></span><h2>Variable code (varcode)<a class="headerlink" href="#variable-code-varcode" title="Permalink to this headline">¶</a></h2>
<p>A code from a local variation of BUFR/CREX Table B that describes the nature of
the variable, such as what it measures and the units used for measuring. It is
identified by a <em>local B table descriptor</em> (see <a class="reference internal" href="../btable.html#btable"><span class="std std-ref">Local B table codes</span></a>).</p>
</div>
<div class="section" id="value">
<h2>Value<a class="headerlink" href="#value" title="Permalink to this headline">¶</a></h2>
<p>A measured value is a datum that can be expressed as a floating point (single
or double precision), integer, character or byte, depending on what value it
measures.</p>
<p>Every datum is univocally defined by a system of coordinates with 7 dimensions:</p>
<ol class="arabic simple">
<li>A report type (see <a class="reference internal" href="#report"><span class="std std-ref">Report</span></a>).</li>
<li>The variable code (see <a class="reference internal" href="#varcode"><span class="std std-ref">Variable code (varcode)</span></a>).</li>
<li>The <em>date and time</em> of validity of the datum, be it observed, forecast or
estimated.</li>
<li><em>station</em> information about what generated the value (also defining its x
and y coordinates).</li>
<li>The vertical coordinates in space, as a description of the <em>level</em>.</li>
<li>The <em>time range</em> of the measurement.</li>
</ol>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>Values in DB-All.e are also associated to zero or more <em>attributes</em>.  An
attribute is a value that describes an aspect of a variable, like for example a
confidence interval.</p>
<p>Attributes in DB-All.e consist on a value and a local B table descriptor,
which describes the nature of the variable, such as what it represents and the
units in which it is represented.</p>
<p>Attributes are uniquely identified by the variable they refer to and the B
table descriptor of the attribute.  As a consequence, you can only have one
attribute per value with a specific B table descriptor.  This means that, for
example, a variable can have at most one confidence interval attribute.</p>
</div>
<div class="section" id="input-output-actions">
<span id="routines"></span><h2>Input, output, actions<a class="headerlink" href="#input-output-actions" title="Permalink to this headline">¶</a></h2>
<p>Work with DB-All.e happens using <em>action routines</em>.  An action routine
typically reads some input, performs an action and produces some output.
Example of action routines are <a class="reference internal" href="reference.html#c.idba_query_data" title="idba_query_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_query_data()</span></code></a> to query data from a
database and <a class="reference internal" href="reference.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> to write data into the database.</p>
<p>The input and the output of action routines are collections of parameters which
have a name and a value.  A list of parameters can be found in <a class="reference internal" href="../parms.html#parms"><span class="std std-ref">Input/output/query parameters</span></a>.</p>
<p>You can set the input parameters using the <cite>idba_set*</cite> functions:</p>
<ul class="simple">
<li><cite>idba_seti(handle, “param”, intvalue)</cite>: Set the input parameter to the
integer value <cite>intvalue</cite>.</li>
<li><cite>idba_setc(handle, “param”, charvalue)</cite>:
Set the input parameter to the character value <cite>charvalue</cite></li>
<li><cite>idba_setr(handle, “param”, realvalue)</cite>:
Set the input parameter to the real value <cite>realvalue</cite></li>
<li><cite>idba_setd(handle, “param”, doublevalue)</cite>:
Set the input parameter to the <cite>real*8</cite> value <cite>doublevalue</cite></li>
<li><cite>idba_set_station_context(handle)</cite>:
Sets the date, time, level and time range in the input record to some magic
values, to signal that we are going to work with station attributes instead
of normal values.</li>
</ul>
<p>You can read the output parameters using the <cite>idba_enq*</cite> functions:</p>
<ul class="simple">
<li><cite>idba_enqi(handle, “param”, intvalue)</cite>:
Read the output parameter into the integer value <cite>intvalue</cite></li>
<li><cite>idba_enqc(handle, “param”, charvalue)</cite>:
Read the output parameter into the character value <cite>charvalue</cite></li>
<li><cite>idba_enqr(handle, “param”, realvalue)</cite>:
Read the output parameter into the real value <cite>realvalue</cite></li>
<li><cite>idba_enqd(handle, “param”, doublevalue)</cite>:
Read the output parameter into the <cite>real*8</cite> value <cite>doublevalue</cite></li>
</ul>
<p>Note that all <code class="docutils literal notranslate"><span class="pre">idba_set*</span></code> functions set input parameters, while all <code class="docutils literal notranslate"><span class="pre">idb_enq*</span></code>
functions read output parameters.  You cannot read input parameters or set
output parameters: that is the job of action routines.</p>
<p>In other words, input and output parameters are different things.  In this
code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! A possible misunderstanding</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_enqi</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>the value of <cite>val</cite> after the <a class="reference internal" href="reference.html#c.idba_enqi" title="idba_enqi"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_enqi()</span></code></a> will not probably be 1, and
it could be either a value indicating <code class="docutils literal notranslate"><span class="pre">missing</span> <span class="pre">value</span></code> (in case no
<code class="docutils literal notranslate"><span class="pre">height</span></code> parameter is set in the output parameters) or a <code class="docutils literal notranslate"><span class="pre">height</span></code> value
previously retrieved by an action routine.</p>
<p>To reset one input parameter you can use <a class="reference internal" href="reference.html#c.idba_unset" title="idba_unset"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unset()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! We do not want to limit results by latitude this time</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unset</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmin&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unset</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmax&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_query_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can reset an input parameter by setting it to one of the
special <code class="docutils literal notranslate"><span class="pre">missing</span> <span class="pre">value</span></code> values listed below.</p>
<p>To reset all input parameters you can use <a class="reference internal" href="reference.html#c.idba_unsetall" title="idba_unsetall"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unsetall()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Restart the query from scratch</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unsetall</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setd</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmin&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="mf">0.D0</span><span class="p">)</span>
</pre></div>
</div>
<p>To reset only Bxxyyy variables you can use <a class="reference internal" href="reference.html#c.idba_unsetb" title="idba_unsetb"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unsetb()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Insert a new variable with the old station, level and so on</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unsetb</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setd</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;B12101&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<p>There is no way to reset output parameters: it is not needed since all action
routines will get rid of old output values before producing new ones.</p>
<p>In case one of the <code class="docutils literal notranslate"><span class="pre">idba_enq*</span></code> functions is called on a parameter which
does not exist, it will return a special value that indicates “missing
value”.  This is a list of such special values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Data Type</th>
<th class="head">Missing value indicator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>String</td>
<td><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></td>
</tr>
<tr class="row-odd"><td>Int</td>
<td><code class="docutils literal notranslate"><span class="pre">0x7fffffff</span></code></td>
</tr>
<tr class="row-even"><td>Real</td>
<td><code class="docutils literal notranslate"><span class="pre">-1.1754944E-38</span></code></td>
</tr>
<tr class="row-odd"><td>Double</td>
<td><code class="docutils literal notranslate"><span class="pre">-2.22507E-308</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">dballe</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../parms.html">Input/output/query parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../btable.html">Local B table codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ltypes.html">Level type values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tranges.html">Time range values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aliases.html">Varcode aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../env.html">DB-All.e environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connect.html">Connecting to DB-All.e</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/dballe.html">Python dballe package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/dballe.volnd.html">Python dballe.volnd package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/dballe.html">C++ dballe namespace</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="dballe.html">Fortran dballe functions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Fortran API concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough.html">A walk through the Fortran API</a></li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactional behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Fortran dballe functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ and Troubleshooting</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="dballe.html">Fortran dballe functions</a><ul>
      <li>Previous: <a href="dballe.html" title="previous chapter">Fortran dballe functions</a></li>
      <li>Next: <a href="walkthrough.html" title="next chapter">A walk through the Fortran API</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Enrico Zini.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/fortran/concepts.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>