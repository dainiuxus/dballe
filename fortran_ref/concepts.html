
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Fortran API concepts &#8212; dballe 3.23 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transactional behaviour" href="transactions.html" />
    <link rel="prev" title="Fortran reference" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fortran-api-concepts">
<h1>Fortran API concepts<a class="headerlink" href="#fortran-api-concepts" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This is a list of basic concepts used by the Fortran API.</p>
<p>See <a class="reference internal" href="../general_ref/concepts.html#concepts"><span class="std std-ref">General concepts</span></a> for general concepts.</p>
<div class="section" id="connections-sessions-and-handles">
<span id="sessions"></span><h2>Connections, sessions and handles<a class="headerlink" href="#connections-sessions-and-handles" title="Permalink to this headline">¶</a></h2>
<p>DB-All.e stores meteorological values in a database.  This database can be
optionally shared or accessed using the network.</p>
<p>You contact DB-All.e by creating a <em>connection</em>, and you work in DB-All.e using
one or more <em>sessions</em>.  A connection is an established link between your
program and DB-All.e, and you usually open it at the beginning of your work and
close it at the end.</p>
<p>Within a connection you can create many working sessions.  This is used to do
different things at the same time, like reading a set of values while writing
computed results.</p>
<p>You can also set some safety features on sessions: for example, when you create
a session for reading values you can set it to disable all writes, which helps
you catch some programming mistakes.</p>
<p>You refer to the connection and the sessions using <em>handles</em>.  A handle is an
integer value that you use when you need to refer to something that is not
otherwise representable in any Fortran data type.</p>
<p>When you create a connection or a session, DB-All.e will give you the integer
handle that you will later use to refer to it.</p>
<p>Sessions run with their own database transaction, which means that the changes
they perform on data are handled in an all-or-nothing fashion. If you close a
session with <a class="reference internal" href="functions.html#c.idba_commit" title="idba_commit"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_commit()</span></code></a>, then all the changes made will be preserved. If
you do not call <a class="reference internal" href="functions.html#c.idba_commit" title="idba_commit"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_commit()</span></code></a>, such as if your program unexpectedly
terminates, then all the changes made will be undone.</p>
</div>
<div class="section" id="station-values">
<h2>Station values<a class="headerlink" href="#station-values" title="Permalink to this headline">¶</a></h2>
<p>The interface to work with station values is the same as the interface to work
with normal values, except that date, time, level, and timerange information
are not set when inserting or querying data, and
<a class="reference internal" href="functions.html#c.idba_set_station_context" title="idba_set_station_context"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_set_station_context()</span></code></a> is called instead, to signal the
intention of working with station values.</p>
<p>See <a class="reference internal" href="../fortran_how/query.html#querying"><span class="std std-ref">Querying the database</span></a> for examples on how to work with values.</p>
</div>
<div class="section" id="input-output-actions">
<span id="routines"></span><h2>Input, output, actions<a class="headerlink" href="#input-output-actions" title="Permalink to this headline">¶</a></h2>
<p>Work with DB-All.e happens using <em>action routines</em>.  An action routine
typically reads some input, performs an action and produces some output.
Example of action routines are <a class="reference internal" href="functions.html#c.idba_query_data" title="idba_query_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_query_data()</span></code></a> to query data from a
database and <a class="reference internal" href="functions.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> to write data into the database.</p>
<p>The input and the output of action routines are collections of parameters which
have a name and a value.  A list of parameters can be found in <a class="reference internal" href="../general_ref/parms.html#parms"><span class="std std-ref">Input/output/query parameters</span></a>.</p>
<p>You can set the input parameters using the <cite>idba_set*</cite> functions:</p>
<ul class="simple">
<li><cite>idba_seti(handle, “param”, intvalue)</cite>: Set the input parameter to the
integer value <cite>intvalue</cite>.</li>
<li><cite>idba_setc(handle, “param”, charvalue)</cite>:
Set the input parameter to the character value <cite>charvalue</cite></li>
<li><cite>idba_setr(handle, “param”, realvalue)</cite>:
Set the input parameter to the real value <cite>realvalue</cite></li>
<li><cite>idba_setd(handle, “param”, doublevalue)</cite>:
Set the input parameter to the <cite>real*8</cite> value <cite>doublevalue</cite></li>
<li><cite>idba_set_station_context(handle)</cite>:
Sets the date, time, level and time range in the input record to some magic
values, to signal that we are going to work with station attributes instead
of normal values.</li>
</ul>
<p>You can read the output parameters using the <cite>idba_enq*</cite> functions:</p>
<ul class="simple">
<li><cite>idba_enqi(handle, “param”, intvalue)</cite>:
Read the output parameter into the integer value <cite>intvalue</cite></li>
<li><cite>idba_enqc(handle, “param”, charvalue)</cite>:
Read the output parameter into the character value <cite>charvalue</cite></li>
<li><cite>idba_enqr(handle, “param”, realvalue)</cite>:
Read the output parameter into the real value <cite>realvalue</cite></li>
<li><cite>idba_enqd(handle, “param”, doublevalue)</cite>:
Read the output parameter into the <cite>real*8</cite> value <cite>doublevalue</cite></li>
</ul>
<p>Note that all <code class="docutils literal notranslate"><span class="pre">idba_set*</span></code> functions set input parameters, while all <code class="docutils literal notranslate"><span class="pre">idb_enq*</span></code>
functions read output parameters.  You cannot read input parameters or set
output parameters: that is the job of action routines.</p>
<p>In other words, input and output parameters are different things.  In this
code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! A possible misunderstanding</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_enqi</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>the value of <cite>val</cite> after the <a class="reference internal" href="functions.html#c.idba_enqi" title="idba_enqi"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_enqi()</span></code></a> will not probably be 1, and
it could be either a value indicating <code class="docutils literal notranslate"><span class="pre">missing</span> <span class="pre">value</span></code> (in case no
<code class="docutils literal notranslate"><span class="pre">height</span></code> parameter is set in the output parameters) or a <code class="docutils literal notranslate"><span class="pre">height</span></code> value
previously retrieved by an action routine.</p>
<p>To reset one input parameter you can use <a class="reference internal" href="functions.html#c.idba_unset" title="idba_unset"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unset()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! We do not want to limit results by latitude this time</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unset</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmin&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unset</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmax&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_query_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can reset an input parameter by setting it to one of the
special <code class="docutils literal notranslate"><span class="pre">missing</span> <span class="pre">value</span></code> values listed below.</p>
<p>To reset all input parameters you can use <a class="reference internal" href="functions.html#c.idba_unsetall" title="idba_unsetall"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unsetall()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Restart the query from scratch</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unsetall</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setd</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;latmin&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="mf">0.D0</span><span class="p">)</span>
</pre></div>
</div>
<p>To reset only Bxxyyy variables you can use <a class="reference internal" href="functions.html#c.idba_unsetb" title="idba_unsetb"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_unsetb()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Insert a new variable with the old station, level and so on</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_unsetb</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setd</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;B12101&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<p>There is no way to reset output parameters: it is not needed since all action
routines will get rid of old output values before producing new ones.</p>
<p>In case one of the <code class="docutils literal notranslate"><span class="pre">idba_enq*</span></code> functions is called on a parameter which
does not exist, it will return a special value that indicates “missing
value”.  This is a list of such special values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Data Type</th>
<th class="head">Missing value indicator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>String</td>
<td><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></td>
</tr>
<tr class="row-odd"><td>Int</td>
<td><code class="docutils literal notranslate"><span class="pre">0x7fffffff</span></code></td>
</tr>
<tr class="row-even"><td>Real</td>
<td><code class="docutils literal notranslate"><span class="pre">-1.1754944E-38</span></code></td>
</tr>
<tr class="row-odd"><td>Double</td>
<td><code class="docutils literal notranslate"><span class="pre">-2.22507E-308</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">dballe</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">How-to guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference.html">Reference documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../general_ref/index.html">General reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_ref/index.html">Python reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp_ref/index.html">C++ reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Fortran reference</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../reference.html">Reference documentation</a><ul>
  <li><a href="index.html">Fortran reference</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Fortran reference</a></li>
      <li>Next: <a href="transactions.html" title="next chapter">Transactional behaviour</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Enrico Zini.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/fortran_ref/concepts.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>