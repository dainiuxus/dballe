
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Working with attributes &#8212; dballe 3.23 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Helpers for pretty-printing" href="describe.html" />
    <link rel="prev" title="Deleting data" href="delete.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="working-with-attributes">
<h1>Working with attributes<a class="headerlink" href="#working-with-attributes" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="reading-attributes">
<h2>Reading attributes<a class="headerlink" href="#reading-attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes are read using <a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_attribute" title="idba_next_attribute"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_attribute()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! ...setup a query...</span>
<span class="n">idba_query_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<span class="k">do while</span> <span class="p">(</span><span class="nb">count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_next_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

  <span class="c">! Read QC informations about the last value read</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_query_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">qc_count</span><span class="p">)</span>
  <span class="k">do while</span> <span class="p">(</span><span class="n">qc_count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_next_attribute</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
      <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_enqc</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
      <span class="c">! ...process the value...</span>
      <span class="n">qc_count</span> <span class="o">=</span> <span class="n">qc_count</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="n">enddo</span>

  <span class="nb">count</span> <span class="o">=</span> <span class="nb">count</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">enddo</span>
</pre></div>
</div>
<p>This code introduces two new functions:</p>
<ul>
<li><p class="first"><a class="reference internal" href="../fortran_ref/functions.html#c.idba_query_attributes" title="idba_query_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_query_attributes()</span></code></a>:
Performs a query to retrieve attributes for the last variable read by
<a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_data" title="idba_next_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_data()</span></code></a>.  It returns the number of attributes available.</p>
</li>
<li><p class="first"><a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_attribute" title="idba_next_attribute"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_attribute()</span></code></a>:
Retrieves one by one the values queried by <a class="reference internal" href="../fortran_ref/functions.html#c.idba_query_attributes" title="idba_query_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_query_attributes()</span></code></a> if
there are no more items available, the function will fail.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">param</span></code> will be set to the name (in the form <code class="docutils literal notranslate"><span class="pre">*Bxxyyy</span></code>) of
the attribute just read.</p>
</li>
</ul>
<p>It is possible to read attributes at a later time giving a context ID and a B
table value:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Read the context ID after a insert_data or a next_data</span>
<span class="n">idba_enqi</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;context_id&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>

<span class="c">! ...a while later...</span>

<span class="c">! Query the attributes of the variable with the given</span>
<span class="c">! context ID and B table value</span>
<span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*context_id&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*var_related&quot;</span><span class="p">,</span> <span class="s2">&quot;B12001&quot;</span><span class="p">)</span>

<span class="c">! These are ways one could choose specific attributes:</span>
<span class="c">! one attribute: idba_setc(handle, &quot;*var&quot;, &quot;B33007&quot;)</span>
<span class="c">! some attributes: idba_setc(handle, &quot;*varlist&quot;, &quot;B33007,B33036&quot;)</span>
<span class="c">! by default, all attributes are returned</span>

<span class="c">! Read QC informations about the last value read</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_query_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">qc_count</span><span class="p">)</span>
<span class="k">do while</span> <span class="p">(</span><span class="n">qc_count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_next_attribute</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
    <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_enqc</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
    <span class="c">! ...process the value...</span>
    <span class="n">qc_count</span> <span class="o">=</span> <span class="n">qc_count</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">enddo</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-attributes">
<h2>Writing attributes<a class="headerlink" href="#writing-attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes are written using <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a>, which can be used after an
<a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_data" title="idba_next_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_data()</span></code></a>, after an <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> or at any time using a stored data
id.  These three case differ on how to communicate to <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> what is
the data about which to write attributes.</p>
<p>When used after <a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_data" title="idba_next_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_data()</span></code></a>, <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> can refer directly to the
last data retrieved:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! ...setup a query...</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_query_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<span class="k">do while</span> <span class="p">(</span><span class="nb">count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_next_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
  <span class="c">! ...process data...</span>

  <span class="c">! Set the attributes</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*B33007&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*B33006&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_insert_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

  <span class="nb">count</span> <span class="o">=</span> <span class="nb">count</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">enddo</span>
</pre></div>
</div>
<p>After an <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> instead, since <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> can write more than
one data at a time, we need to tell <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> which of them we are
referring to:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Insert wind speed and temperature</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setr</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;B11002&quot;</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setr</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;B12001&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_insert_data</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="c">! Set the attributes</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*B33007&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>

<span class="c">! Use &quot;*var_related&quot; to indicate which of the two variables we are annotating</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setc</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*var_related&quot;</span><span class="p">,</span> <span class="s2">&quot;B11002&quot;</span><span class="p">)</span>

<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_insert_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> can also be called at any time using a previously stored data it:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! ...perform a query with idba_query_data...</span>
<span class="k">do while</span> <span class="p">(</span><span class="nb">count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_next_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
  <span class="c">! ...process data...</span>

  <span class="c">! This variable is interesting: save the context ID</span>
  <span class="c">! to refer to it later</span>
  <span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_enqi</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;context_id&quot;</span><span class="p">,</span> <span class="n">saved_id</span><span class="p">)</span>

  <span class="nb">count</span> <span class="o">=</span> <span class="nb">count</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">enddo</span>

<span class="c">! ...some time later...</span>

<span class="c">! Insert attributes about that interesting variable</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*B33007&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*B33006&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>

<span class="c">! Select the variable using its context id</span>
<span class="c">! and variable code</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*context_id&quot;</span><span class="p">,</span> <span class="n">saved_id</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*var_related&quot;</span><span class="p">,</span> <span class="s2">&quot;B11001&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_insert_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
<p>This code introduces a new function:</p>
<ul>
<li><p class="first"><a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a>
Set one or more attributes about a variable.</p>
<p>The variable can be identified directly by using <code class="docutils literal notranslate"><span class="pre">idba_seti(handle,</span> <span class="pre">&quot;*context_id&quot;,</span> <span class="pre">id)</span></code> and <code class="docutils literal notranslate"><span class="pre">idba_seti(handle,</span> <span class="pre">&quot;*var_related&quot;,</span> <span class="pre">name)</span></code>.
These parameters are automatically set by the <a class="reference internal" href="../fortran_ref/functions.html#c.idba_next_data" title="idba_next_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_next_data()</span></code></a> and
<a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_data" title="idba_insert_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_data()</span></code></a> action routines.</p>
<p>The attributes and values are set as input to <a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> using the
<cite>idba_set*</cite> functions with an asterisk in front of the variable name.</p>
</li>
</ul>
<p><a class="reference internal" href="../fortran_ref/functions.html#c.idba_insert_attributes" title="idba_insert_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_insert_attributes()</span></code></a> will work in different ways according to the attributes
opening mode of the database:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;read&quot;</span></code>: attributes cannot be modified in any way.</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;rewrite&quot;</span></code>: attributes can be added, and existing attributes can be
overwritten.</li>
</ul>
</div>
<div class="section" id="deleting-attributes">
<h2>Deleting attributes<a class="headerlink" href="#deleting-attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes are deleted using <a class="reference internal" href="../fortran_ref/functions.html#c.idba_remove_attributes" title="idba_remove_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_remove_attributes()</span></code></a>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! Delete the confidence interval from the wind speed</span>

<span class="c">! The referring variable is identified in the same way as with</span>
<span class="c">! idba_insert_attributes:</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*context_id&quot;</span><span class="p">,</span> <span class="n">saved_id</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_seti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*var_related&quot;</span><span class="p">,</span> <span class="s2">&quot;B11002&quot;</span><span class="p">)</span>

<span class="c">! The attributes to delete are selected by setting &quot;*varlist&quot;:</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_setc</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;*varlist&quot;</span><span class="p">,</span> <span class="s2">&quot;*B33007&quot;</span><span class="p">)</span>
<span class="n">ierr</span> <span class="o">=</span> <span class="n">idba_remove_attributes</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
<p>This code introduces a new function:</p>
<ul class="simple">
<li><a class="reference internal" href="../fortran_ref/functions.html#c.idba_remove_attributes" title="idba_remove_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_remove_attributes()</span></code></a>:
Delete attributes from a variable identified in the same way as with</li>
</ul>
<p><a class="reference internal" href="../fortran_ref/functions.html#c.idba_remove_attributes" title="idba_remove_attributes"><code class="xref c c-func docutils literal notranslate"><span class="pre">idba_remove_attributes()</span></code></a> will not work unless the database has been opened in
attribute <cite>rewrite</cite> mode.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">dballe</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../howtos.html">How-to guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../python_how/index.html">Python HOWTOs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Fortran HOWTOs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../howtos.html">How-to guides</a><ul>
  <li><a href="index.html">Fortran HOWTOs</a><ul>
      <li>Previous: <a href="delete.html" title="previous chapter">Deleting data</a></li>
      <li>Next: <a href="describe.html" title="next chapter">Helpers for pretty-printing</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Enrico Zini.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/fortran_how/attributes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>